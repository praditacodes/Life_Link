{% extends 'blood/adminbase.html' %}
{% block content %}
<br><br>
<div class="container">

    <div class="row">
        <div class="col-sm-3">
          <div class="card bg-light">
            <div class="card-body">
                <div class="blood">
                    <h2>A+ <i class="fas fa-tint"></i></h2>
                </div><br><br>
                <div>
                    {{A1.unit}}
                </div>                            
            </div>
          </div>
        </div>
        <div class="col-sm-3">
            <div class="card bg-light">
                <div class="card-body">
                    <div class="blood">
                        <h2>B+ <i class="fas fa-tint"></i></h2>
                    </div><br><br>
                    <div>
                      {{B1.unit}}
                    </div>                            
                </div>
              </div>
        </div>
        <div class="col-sm-3">
            <div class="card bg-light">
                <div class="card-body">
                    <div class="blood">
                        <h2>O+ <i class="fas fa-tint"></i></h2>
                    </div><br><br>
                    <div>
                      {{O1.unit}}
                    </div>                            
                </div>
              </div>
          </div>
          <div class="col-sm-3">
            <div class="card bg-light">
                <div class="card-body">
                    <div class="blood">
                        <h2>AB+ <i class="fas fa-tint"></i></h2>
                    </div><br><br>
                    <div>
                      {{AB1.unit}}
                    </div>                            
                </div>
              </div>
          </div>
      </div>
  
      <div class="row">
        <div class="col-sm-3">
          <div class="card bg-light">
            <div class="card-body">
                <div class="blood">
                    <h2>A- <i class="fas fa-tint"></i></h2>
                </div><br><br>
                <div>
                  {{A2.unit}}
                </div>                            
            </div>
          </div>
        </div>
        <div class="col-sm-3">
            <div class="card bg-light">
                <div class="card-body">
                    <div class="blood">
                        <h2>B- <i class="fas fa-tint"></i></h2>
                    </div><br><br>
                    <div>
                      {{B2.unit}}
                    </div>                            
                </div>
              </div>
        </div>
        <div class="col-sm-3">
            <div class="card bg-light">
                <div class="card-body">
                    <div class="blood">
                        <h2>O- <i class="fas fa-tint"></i></h2>
                    </div><br><br>
                    <div>
                      {{O2.unit}}
                    </div>                            
                </div>
              </div>
          </div>
          <div class="col-sm-3">
            <div class="card bg-light">
                <div class="card-body">
                    <div class="blood">
                        <h2>AB- <i class="fas fa-tint"></i></h2>
                    </div><br><br>
                    <div>
                      {{AB2.unit}}
                    </div>                            
                </div>
              </div>
          </div>
      </div>
<hr>
    <div class="row">
      <div class="col-sm-3">
        <div class="card bg-light">
          <div class="card-body">
              <div class="blood">
                  <i class="fas fa-users"></i>
              </div><br>
              <div>
                  Total Donors <br>
                  {{totaldonors}}
              </div>                            
          </div>
        </div>
      </div>
      <div class="col-sm-3">
          <div class="card bg-light">
              <div class="card-body">
                  <div class="blood">
                      <i class="fas fa-spinner"></i>
                  </div><br>
                  <div>
                      Total Requests <br>
                     {{totalrequest}}
                  </div>                            
              </div>
            </div>
      </div>
      <div class="col-sm-3">
          <div class="card bg-light">
              <div class="card-body">
                  <div class="blood">
                      <i class="far fa-check-circle"></i>
                  </div><br>
                  <div>
                      Approved Requests <br>
                      {{totalapprovedrequest}}
                  </div>                            
              </div>
            </div>
        </div>
        <div class="col-sm-3">
          <div class="card bg-light">
              <div class="card-body">
                  <div class="blood">
                      <i class="fas fa-tint xyz"></i>
                  </div><br>
                  <div>
                      Total Blood Unit (in ml) <br>
                      {{totalbloodunit}}
                  </div>                            
              </div>
            </div>
        </div>
    </div>
    <!-- Key Stats -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="card bg-light text-center">
          <div class="card-body">
            <div class="blood"><i class="fas fa-hand-holding-medical fa-2x text-danger"></i></div>
            <div class="mt-2">Total Donations<br><span class="h4">{{total_donations}}</span></div>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card bg-light text-center">
          <div class="card-body">
            <div class="blood"><i class="fas fa-tint fa-2x text-danger"></i></div>
            <div class="mt-2">Total Units Donated<br><span class="h4">{{total_units_donated}}</span></div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card bg-light text-center">
          <div class="card-body">
            <div class="blood"><i class="fas fa-trophy fa-2x text-warning"></i></div>
            <div class="mt-2">Top Donors (by units donated)</div>
            <table class="table table-sm mt-2 mb-0">
              <thead class="thead-light">
                <tr><th>Name</th><th>Blood Group</th><th>Units</th><th>Donations</th><th>Last Donation</th></tr>
              </thead>
              <tbody>
                {% for donor in top_donors %}
                <tr>
                  <td>{{donor.donor__user__first_name}} {{donor.donor__user__last_name}}</td>
                  <td>{{donor.donor__bloodgroup}}</td>
                  <td>{{donor.total_units}}</td>
                  <td>{{donor.donation_count}}</td>
                  <td>{{donor.last_donation}}</td>
                </tr>
                {% empty %}
                <tr><td colspan="5">No donations yet.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!-- Charts -->
    <div class="row">
      <div class="col-md-6 mb-4">
        <div class="card bg-light">
          <div class="card-body">
            <h5 class="card-title">Donations Per Month</h5>
            <canvas id="donationsChart"></canvas>
          </div>
        </div>
      </div>
      <div class="col-md-6 mb-4">
        <div class="card bg-light">
          <div class="card-body">
            <h5 class="card-title">Blood Group Distribution</h5>
            <canvas id="bloodGroupChart"></canvas>
          </div>
        </div>
      </div>
    </div>
</div>
<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Donations Per Month
  var ctx1 = document.getElementById('donationsChart').getContext('2d');
  var donationsChart = new Chart(ctx1, {
    type: 'bar',
    data: {
      labels: {{ chart_labels|safe }},
      datasets: [{
        label: 'Units Donated',
        data: {{ chart_data|safe }},
        backgroundColor: 'rgba(244,67,54,0.7)',
        borderColor: 'rgba(244,67,54,1)',
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
      scales: { y: { beginAtZero: true } }
    }
  });
  // Blood Group Distribution
  var ctx2 = document.getElementById('bloodGroupChart').getContext('2d');
  var bloodGroupChart = new Chart(ctx2, {
    type: 'pie',
    data: {
      labels: {{ bg_labels|safe }},
      datasets: [{
        label: 'Units',
        data: {{ bg_data|safe }},
        backgroundColor: [
          '#f44336','#e57373','#ba68c8','#64b5f6','#4caf50','#ffd54f','#ff8a65','#a1887f'
        ],
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { position: 'bottom' } }
    }
  });
</script>
{% endblock content %}
